<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>Title</title></head><body><script>//    var promise = new Promise(function (resolve, reject) {//        if (/*success*/){//            resolve(value)//        } else{//            reject(error)//        }//    })////    promise.then(function (value) {//        //success//    }, function (error) {//        //failure//    })/*    function timeout(ms){        return new Promise((resolve, reject) => {            setTimeout(resolve, ms, 'done');        })    }    timeout(1000).then((value) => {        console.log(value);    })    let promise = new Promise(function (resolve, reject) {        console.log("promise");        resolve();    })    promise.then(function () {        console.log("resolve");    })    console.log("hi");    function loadImageAsync(url){        return new Promise(function (resolve, reject) {            var image = new Image();            image.onload = function () {                resolve(image);            }            image.onerror = function () {                reject(new Error('could not load image at ' + url ))            }            image.src = url;        })    }    var getJSON = function (url) {        var promise  = new Promise(function (resolve, reject) {            var client = new XMLHttpRequest();            client.open("GET", url);            client.onreadystatechange = handler;            client.responseType = 'json';            client.setRequestHeader("Accept", "application/json");            client.send();            function handler() {                if (this.readyState !== 4) {                    return;                }                if (this.status === 200) {                    resolve(this.response);                } else {                    reject(new Error(this.statusText));                }            }        });        return promise;    }    getJSON("/posts.json").then(function (json) {        console.log(json);    }, function (err) {        console.error(err);    })   *///window.o = new Promise(function(resolve, reject) {////    setTimeout(function() {//        console.log("aabd")//    },2000);////    resolve("55");//    reject("rejected")//});// findByUsername(user, function(err, userinfo){//     //cannot find the user//     if (err) {//         return res.json({//             code: 1000,//             message: "查询用户信息，数据库操作数出现异常"//         })//     }////     if (userinfo && userinfo.length >0) {//         if (userinfo[0].pwd === pwd){//             return res.json({//                 code:0,//                 message: "登录成功"//             })//         }//     }////     loginEducationSystem(name, pwd, function(err, result) {////         if (err) {//             return res.json({//                 code: 1001,//                 message: "模拟登录教务系统出现异常"//             })//         }////         if (result.code !== 0) {//            return res.json({//                code: 1002,//                message: "模拟登录教务系统失败，可能是用户名或密码错误"//            })//         }////         saveUserToDB(user, pwd, function(err, result) {//             if(err) {//                 return res.json({//                     code: 1003,//                     message:'将用户名密码存入数据库出现异常'//                 })//             }////             if (result.code !== 0){//                 return res.json({//                     code: 1004,//                     message: "将用户名密码存入数据库出现异常"//                 })//             }////             return res.json({//                 code: 0,//                 message: "登录成功!"//             })//         });//     });// });////// function start() {//     return new Promise(function(resolve, reject) {//         return resolve("start");//     })// }////// start().then(function(data) {//     console.log('result of start, '+ data);//     return Promise.resolve(1);// }).then(function(data) {//     console.log('result of p1:' + data);//     //p2//     return Promise.reject({//         notRealPromiseException: true//     });// }).then(function(data) {//     console.log("result of p2: "+ data);//     return Promise.reslove(3); //p3// }).catch(function(ex) {//     console.log("ex: "+ ex);//     if (ex.notRealPromiseException) {//         ////         return true;//     }//     return false;// })const findUserByName = (name, pwd) => {    return new Promise((resolve, reject) => {        // 数据库查询操作        if (dbError) {            // 数据库查询出错，将 promise 设置为 rejected            reject({                code: 1000,                message: '查询用户信息，数据库操作数出现异常',            });        }        // 将查询结果赋给 userinfo 变量        if (userinfo.length === 0) {            // 数据库中不存在该用户            resolve();        }        // 数据库存在该用户，判断密码是否正确        if (pwd === userinfo[0].pwd) {            // 密码正确，中止 promise 执行            reject({                notRealPromiseException: true,                data: {                    code: 0,                    message: '密码正确，登录成功',                }            });        }        // 密码不正确，登录失败，将 Promise 设置为 Rejected 状态        reject({            code: 1001,            message: '密码不正确，登录失败',        });    });};// 模拟登录教务系统const loginEducationSystem = (name, pwd) => {    return new Promise((resolve, reject) => {        // 登录逻辑...        // 登录成功        resolve();        // 登录失败        reject({            code: 1002,            message: '模拟登录教务系统失败',        });    });};// 将用户名密码存入数据库const saveUserToDB(name, pwd) => {    return new Promise((resovle, reject) => {        // 数据库存储操作        if (dbError) {            // 数据库存储出错，将 promise 设置为 rejected            reject({                code: 1004,                message: '数据库存储出错，将出现异常',            });        }        // 数据库存储操作成功        resolve();    });}};findUserByName(name)    .then(() => {        return loginEducationSystem(name, pwd);    })    .then(() => {        return saveUserToDB(name, pwd);    })    .catch(e => {        // 判断异常出现原因        if (e.notRealPromiseException) {            // 正常中止 promise 而故意设置的异常            return res.json(e.data);        }        // 出现错误或异常        return res.json(e);    });</script></body></html>